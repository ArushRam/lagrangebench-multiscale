# Pooling Modules

Pooling modules subclass from the `BasePooling` module and return coarse graph assignments generated by specific implementations. A usage example based on the LagrangeBench tutorial using the TGV2D dataset is given below, for the specific example of VoxelClustering.


### Data Setup
```
import lagrangebench
import haiku as hk
import numpy as np

tgv2d_train = lagrangebench.TGV2D("train", extra_seq_length=5, nl_backend="matscipy")  # extra_seq_length=5 will be clear later
tgv2d_valid = lagrangebench.TGV2D("valid", extra_seq_length=20, nl_backend="matscipy")

noise_std = 3e-4
pf_config = {
    "steps": [-1, 500, 700],  # training steps to unlock the relative stage
    "unrolls": [0, 2, 5],  # number of unroll steps per stage
    "probs": [7, 2, 1],  # relative probabilities to unroll to the relative stage
}

bounds = np.array(tgv2d_train.metadata["bounds"])
box = bounds[:, 1] - bounds[:, 0]

tgv2d_case = lagrangebench.case_builder(
    box=box,  # (x,y) array with the world size along each axis. (1.0, 1.0) for 2D TGV
    metadata=tgv2d_train.metadata,  # metadata dictionary
    input_seq_length = 6,  # number of consecutive time steps fed to the model
    cfg_model={"isotropic_norm": False},  # normalize each dimension independently
    noise_std=noise_std,  # noise standard deviation used by the random-walk noise
)
```

### Example call

```
particle_type = tgv2d_train[0][1]
features = tgv2d_case.allocate_eval(tgv2d_train[0])[0]

voxel_size = 0.05
bounds = np.array(tgv2d_train.metadata["bounds"])

def voxel_clustering_forward(features: Dict[str, jnp.ndarray], particle_type: jnp.ndarray):
    pool = VoxelClustering(voxel_size, bounds)
    return pool(features, particle_type)

# Transform the function using Haiku
voxel_clustering_fn = hk.without_apply_rng(hk.transform(voxel_clustering_forward))

# Initialize the Haiku module
params = voxel_clustering_fn.init(None, features, particle_type)

# Apply the module
coarse_sample, new_particle_types = voxel_clustering_fn.apply(params, features, particle_type)

print(coarse_sample['coarse_ids'], new_particle_types)
```